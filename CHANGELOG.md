# 更新日志

### v3.2.0 - 性能与安全优化
- ✅ **数据获取优化**: 优化了数据获取时机，确保 `videoData` 和 `targetFolders` 在需要时完整获取，避免重复请求，提高性能。
- ✅ **CSRF Token 安全增强**: 统一了 CSRF Token 的获取和验证方式，提高了安全性和可靠性，支持多种获取方式（cookie、meta 标签等）。
- ✅ **数据完整性验证**: 添加了数据完整性检查机制，确保在数据完整时才进行处理，提高系统稳定性。
- ✅ **代码模块化改进**: 进一步优化了代码结构，提高了可维护性和可扩展性。
- ✅ **测试框架完善**: 添加了完整的测试文件，包括单元测试和集成测试，确保代码质量。

### v3.1.0 - 沉浸式侧边按钮功能
- ✅ **新增沉浸式侧边按钮**: 在视频播放页面右侧添加优雅的侧边按钮，采用毛玻璃效果设计，支持多种状态显示（空闲、加载中、成功、错误）。
- ✅ **手动触发模式**: 用户可以完全控制何时进行AI分类，点击按钮后触发分析并展开推荐面板，避免自动推荐可能带来的干扰。
- ✅ **流畅动画效果**: 按钮具有脉冲动画和波纹效果，提供丰富的视觉反馈，增强用户体验。
- ✅ **响应式设计**: 完美适配各种屏幕尺寸和深色模式，包括B站的深色主题。
- ✅ **模式选择**: 在设置页面新增自动/手动模式选择，用户可以根据个人偏好选择推荐方式。

### v3.0.0 - 悬浮推荐功能与架构优化
- ✅ **新增悬浮推荐功能**: 在视频播放页面右上角自动显示AI推荐收藏夹的悬浮组件，提供一键收藏功能，无需任何点击操作即可获得智能推荐。
- ✅ **Aether设计哲学**: 悬浮推荐组件采用Aether设计哲学，支持深色/浅色模式自动适配，具有优雅的滑入/滑出动画效果。
- ✅ **实时视频检测**: 自动检测当前视频页面的视频信息，监听URL变化，支持单页应用的视频切换，避免重复处理同一个视频。
- ✅ **智能推荐系统**: 基于视频标题、描述和UP主信息进行AI分类，提供推荐置信度显示，处理"无合适收藏夹"的情况。
- ✅ **新增状态管理**: 添加了专门的 floatingRecommendationStore，管理悬浮推荐相关的状态、加载状态、错误信息和用户操作回调。


### v2.9.0 - 架构全面重构
- ✅ **状态管理升级**: 使用 Pinia 替代了简单的 store.js 对象，创建了四个专门的 store 模块（settingsStore、classificationStore、diagnosisStore、uiStore），使状态管理更加规范和可维护。
- ✅ **服务层架构**: 创建了五个专门的服务类（SettingsService、ClassificationService、DiagnosisService、AnalyticsService、FolderService），将业务逻辑从组件中分离出来，实现了更好的关注点分离。
- ✅ **UI组件拆分**: 将 App.vue 中的UI部分拆分为三个专门的组件（MainLayout、TabNavigation、LogPanel），使组件结构更加清晰。
- ✅ **组件通信机制**: 实现了多种通信机制，包括 Pinia 状态管理、Props 和 Events、事件总线（EventBus）和 Provide/Inject，使组件之间的通信更加灵活。
- ✅ **代码量显著减少**: App.vue 文件从 784 行减少到 295 行，减少了约 62% 的代码量。
- ✅ **开发效率提升**: 模块化的结构使开发更加高效，代码结构更加清晰，易于维护和扩展。
- ✅ **文档完善**: 创建了详细的重构文档，帮助开发者更好地理解和使用新的架构。

### v2.8.0 - 一键创建收藏夹优化
- ✅ **收藏夹存在性检测**: 优化了"一键创建推荐收藏夹"功能，现在在创建前会先检查用户已存在的收藏夹列表，自动跳过已存在的收藏夹，避免重复创建失败。
- ✅ **智能提示优化**: 改进了创建过程中的提示信息，明确显示已跳过的收藏夹数量和实际需要创建的收藏夹数量，提升用户体验。
- ✅ **错误处理增强**: 增强了获取收藏夹列表失败时的错误处理，提供更友好的错误提示。

### v2.7.0 - App 组件化重构
- ✅ **组件拆分**: 将庞大的 `App.vue` 组件按照职责拆分为四个独立的子组件 (`SettingsView`, `ClassifyView`, `DiagnoseView`, `ResultsView`)，显著提升了代码的可读性和可维护性。
- ✅ **清晰数据流**: 重构了父子组件的通信方式，统一使用 `props` 向下传递数据，通过 `emits` 向上通知状态变更，使数据流更加清晰可控。
- ✅ **单一职责原则**: 每个组件现在都遵循单一职责原则，`App.vue` 作为容器负责核心逻辑，而视图组件则专注于UI展示和用户交互。

### v2.6.0 - UI/UX 重构与交互优化
- ✅ **引入步骤式布局**: 将“批量分类”页面重构为清晰的三个步骤，显著降低了用户的认知成本。
- ✅ **新增穿梭框组件**: 使用了全新的穿梭框（Transfer List）组件来替代原有的长列表，支持搜索过滤和一键全选，极大地提升了在大量收藏夹中进行选择的效率。
- ✅ **简化交互**: 根据用户反馈，将穿梭框的交互模式简化为直接点击即可移动项目，移除了中间的确认按钮，使操作更快捷。
- ✅ **修复逻辑缺陷**: 修正了“强制重新分类”功能与新选择器之间的逻辑冲突，确保在勾选该项后，源收藏夹可以被选为目标。
- ✅ **优化布局**: 根据用户反馈，将“一键创建推荐收藏夹”按钮调整至更合理的第一步。

### v2.5.0 - 实时分类功能移除与流程优化
- ✅ **移除实时分类功能**: 移除了视频播放页的实时分类功能，专注于悬浮推荐和批量分类。
- ✅ **优化收藏体验**: 简化了收藏流程，用户现在可以通过悬浮推荐组件直接进行一键收藏。

### v2.4.0 - 新增强制重新分类功能
- ✅ **新增强制重新分类选项**: 在批量分类界面，增加了一个“强制重新分类”的复选框。勾选后，脚本将对所有选中的视频进行AI分析，即使它们已经存在于目标收藏夹中，从而实现对收藏夹的彻底重构。

### v2.3.0 - 性能优化与智能诊断
- ✅ **处理效率革命**: 重构了批量分类的核心逻辑，从“逐个请求AI”升级为“**批量请求AI**”。现在脚本会根据设定的批次大小，将多个视频信息打包成单次请求发送给AI，极大地提升了处理速度并降低了API请求频率。
- ✅ **新增智能诊断功能**: 在UI中增加了全新的“智能诊断”标签页。
- ✅ **全局扫描与分析**: 实现了扫描用户所有收藏夹下的所有视频，并分块发送给AI进行主题聚类分析的功能。
- ✅ **交互式诊断报告**: 分析完成后，会在前端生成一份可交互的报告，展示AI建议创建的新分组。
- ✅ **一键优化**: 用户可以根据报告内容勾选建议，并一键执行创建收藏夹等优化操作。

### v2.2.0 - 结果可视化与交互式修正
- ✅ **可视化结果报告**: 任务结束后，不再是简单的弹窗，而是展示一个包含数据图表（甜甜圈图）和详细结果列表的全新视图。
- ✅ **交互式修正**: 在结果列表中，用户可以方便地通过下拉菜单修改AI的分类建议。
- ✅ **一键应用修正**: 用户在审查和修正完毕后，可以点击一个按钮，让脚本根据最终的分类结果批量移动视频。

### v2.1.0 - 稳定性与体验增强
- ✅ **任务持久化**: 批量分类任务的状态会被自动保存。即使用户关闭页面，下次打开时也可以从断点处继续，避免因意外中断导致前功尽弃。
- ✅ **自动重试机制**: 针对B站和AI服务的API请求都加入了自动重试功能。当遇到网络波动或API临时限流时，脚本会进行多次尝试，显著提高了任务的成功率和稳定性。

### v2.0.0 - UI框架重构 (Vue.js)
- ✅ **引入Vue.js**: 项目UI层完全由Vue.js驱动，告别了手动的DOM操作，转向了现代化的、声明式的UI开发模式。
- ✅ **组件化**: 将原有的 `panel.html` 和 `ui.js` 的逻辑重构为一个单一的 `App.vue` 组件，实现了视图、逻辑和样式的高度内聚。
- ✅ **响应式状态管理**: 利用Vue的响应式系统来管理UI状态，代码更简洁，数据流更清晰。
- ✅ **构建流程升级**: 更新了Vite配置，通过 `@vitejs/plugin-vue` 插件无缝支持Vue单文件组件的编译和打包。
- ✅ **代码结构优化**: 简化了 `main.js` 和 `ui.js` 的职责，使其专注于应用初始化和挂载，进一步提升了项目的模块化程度和可维护性。

### v1.6.0 - 收藏体验优化
- ✅ **首次使用引导**: 当用户在视频页首次触发收藏但未配置API Key时，弹窗会友好地提示用户前往个人空间进行设置。
- ✅ **增加“仅收藏”选项**: 在收藏弹窗中，新增了“仅收藏”按钮，允许用户选择只执行B站原生的收藏操作，而不进行移动，给予用户更大的灵活性。
- ✅ **明确收藏流程**: 优化了弹窗文案，清晰地告知用户视频会先被收藏到默认收藏夹，然后再移动到目标收藏夹，提升了操作的透明度。

### v1.5.0 - 任务控制与体验优化
- ✅ **任务控制**: 在批量分类时，新增 **暂停/恢复** 和 **停止** 功能，给予用户完全的控制权。
- ✅ **任务摘要**: 任务结束后，弹出摘要窗口，清晰反馈处理结果（成功、失败、跳过）。
- ✅ **异步流程改进**: 重构了任务处理逻辑，采用 `async/await` 优化异步流程，增强了代码的稳定性和可读性。
- ✅ **UI/UX 优化**: 调整了操作按钮的布局和样式，使交互更直观。

### v1.4.0 - 现代化重构
- ✅ **构建工具**: 引入 Vite 作为开发和构建工具，提供热更新开发体验。
- ✅ **代码重构**: 项目完全模块化，使用 ES6 `import/export` 语法。
- ✅ **关注点分离**: 将硬编码在 JS 中的 HTML 和 CSS 分离到独立的 `.html` 和 `.css` 文件中。
- ✅ **开发流程**: 添加了详细的开发指南，简化了本地开发和贡献的流程。
- ✅ **构建修复**: 解决了构建过程中因插件兼容性导致的问题。

### v1.3.1 - 模块化初步尝试
- ✅ **代码重构**: 将单文件脚本重构为模块化结构，代码拆分到 `src/` 目录下，提高了可维护性。
- ✅ **文档更新**: 更新了 `README.md` 以反映新的项目结构。

### v1.3.0 - 功能增强
- ✅ **AI支持**: 新增对 **智谱AI (GLM-4)** 的支持。
- ✅ **API适配**: 更新了Bilibili相关API的调用方式，以适应B站最新接口。
- ✅ **UI改进**: 增加了“一键创建推荐收藏夹”功能，并优化了设置面板。