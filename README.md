# Bilibili 收藏夹 AI 分类助手

[![Install](https://img.shields.io/badge/Install-Userscript-brightgreen?style=for-the-badge&logo=tampermonkey)](https://github.com/atri1011/bilibili-favorites-classifier-userscript/raw/main/dist/bilibili-favorites-classifier-userscript.user.js)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)

一个用户脚本，它利用AI（支持OpenAI GPT及智谱AI）来智能地、批量地整理Bilibili收藏夹。它不仅能在您的个人空间页批量处理成百上千的视频，还能在您浏览视频时实时推荐分类，彻底解决收藏夹混乱问题！

---

## ✨ 核心功能

-   🚀 **三重分类模式**:
    -   **批量分类**: 在个人空间页面，通过一个清晰的 **三步式向导**，引导您完成"选择源"、"选择目标"和"开始任务"的全过程。
    -   **悬浮推荐**: 在视频播放页面右上角，**自动显示AI推荐收藏夹**的悬浮组件，提供 **一键收藏** 功能，无需任何点击操作即可获得智能推荐。
    -   **沉浸式侧边按钮**: 在视频播放页面右侧，提供一个优雅的侧边按钮，**点击后触发AI分析**并展开推荐面板，给予用户完全的控制权，避免自动推荐可能带来的干扰。

-   🎨 **现代化的UI体验**:
    -   **步骤化布局**: 复杂的批量操作被分解为简单的步骤，显著降低了用户的认知成本。
    -   **高效列表选择**: 采用 **穿梭框(Transfer List)** 组件来替代传统的复选框列表，支持 **搜索/过滤** 和 **一键全选**，在管理大量收藏夹时尤为高效。
    -   点击悬浮按钮（FAB）即可在新标签页中打开独立的设置页面，提供宽敞、无干扰的操作环境。
    -   提供实时日志窗口，任务进展一目了然。
    -   **收藏夹预览**: 在选择收藏夹时，支持 **鼠标悬停预览** 收藏夹内容，帮助您在收藏前快速了解目标收藏夹。
    -   **悬浮推荐组件**: 采用 **Aether设计哲学**，支持深色/浅色模式自动适配，具有优雅的滑入/滑出动画效果，提供 **置信度显示** 和 **一键收藏** 功能。
    -   **沉浸式侧边按钮**: 采用 **毛玻璃效果** 和 **流畅动画**，支持多种状态显示（空闲、加载中、成功、错误），提供 **脉冲动画** 和 **波纹效果**，完美适配各种屏幕尺寸和深色模式。

-   🤖 **强大的AI支持**:
    -   同时支持 **OpenAI** (`gpt-3.5-turbo`, `gpt-4`, `gpt-4o` 等) 和 **智谱AI** (`glm-4`)。
    -   支持自定义API Host，可接入第三方兼容OpenAI的服务。
    -   支持自定义模型名称，灵活适配未来新模型。

-   💡 **智能与便捷**:
-   内置一套精心设计的推荐收藏夹分类，并支持一键批量创建（自动跳过已存在的收藏夹）。
-   高度可配置，所有设置项均保存在本地，安全可靠。

-   🔄 **进程控制与反馈**:
    -   在批量分类过程中，可以随时 **暂停/恢复** 或 **停止** 任务。
    -   任务结束后，会展示一个包含 **数据图表** 和 **可编辑结果列表** 的可视化报告，让您对分类结果一目了然。
    -   **交互式修正**: 您可以直接在结果列表中修改AI的分类建议，然后一键应用所有修正。

---

## 🚀 快速安装

### 1. 安装脚本管理器

您需要在浏览器中安装一个用户脚本管理器。推荐使用 **Tampermonkey**。

-   [Tampermonkey 官网](https://www.tampermonkey.net/)
-   [Chrome 应用商店](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
-   [Firefox 附加组件](https://addons.mozilla.org/en-US/firefox/addon/tampermonkey/)

### 2. 安装本脚本

点击下方的链接即可安装最新构建版本：

**[📥 点击安装 - Bilibili 收藏夹 AI 分类助手](https://github.com/atri1011/bilibili-favorites-classifier-userscript/raw/main/dist/bilibili-favorites-classifier-userscript.user.js)**

---

## 📋 使用指南

安装成功后，您会在B站页面的右下角看到一个粉色的 **"AI"** 悬浮按钮。

### 场景一：在个人空间页进行批量分类

1.  **访问页面**: 进入您的B站个人空间收藏夹页面 (例如 `https://space.bilibili.com/你的UID/favlist`)。
2.  **打开设置页面**: 点击右下角的 **"AI"** 悬浮按钮，会在一个新的浏览器标签页中打开分类助手的设置与操作页面。
3.  **配置AI**:
    -   在页面上方的“AI设置”区域，选择AI提供商（OpenAI或智谱AI）。
    -   填入您的 **API Key** 和 **API Host**。
    -   选择或自定义AI模型。
    -   点击 **“保存设置”**。
4.  **步骤一：选择源收藏夹**:
    -   在“批量分类”标签页中，您会看到一个穿梭框选择器。
    -   直接点击左侧“所有收藏夹”列表中的项目，即可将其移动到右侧的“已选源收藏夹”列表中。
    -   *小提示：如果您还没有合适的分类，可以点击 **"一键创建推荐收藏夹"** 来快速建立一套分类体系。该功能会自动检测已存在的收藏夹，只创建不存在的分类。*
    -   选择完毕后，点击 **“下一步”**。
5.  **步骤二：选择目标收藏夹**:
    -   以同样的方式，从左侧列表中选择一个或多个用于存放视频的 **目标收藏夹**。
    -   **强制重新分类**: 在列表上方，有一个复选框。默认情况下，为了效率，目标收藏夹列表会排除您已选定的源收藏夹。但如果您希望对收藏夹进行内部整理（即源和目标是同一个），请勾选此项，此时所有收藏夹都将变为可选。
    -   选择完毕后，点击 **“下一步”**。
6.  **步骤三：开始分类**:
    -   设置 **“每批处理视频数”**（建议值为10-20）。
    -   点击 **“开始分类”** 按钮，脚本将开始工作，您可以在下方的日志窗口查看进度。
    -   在任务进行中，您可以随时点击 **“暂停”** 或 **“停止”** 按钮来控制任务进程。
    -   任务结束后，页面会自动切换到 **结果视图**：
        -   左侧的 **图表** 会直观展示视频在不同收藏夹中的分布情况。
        -   右侧的 **结果列表** 详细列出了每个视频的标题、原始收藏夹和AI推荐的目标收藏夹。
        -   如果AI的推荐不符合您的心意，您可以直接在列表中通过下拉菜单 **修正** 它的分类。
        -   完成所有检查和修正后，点击 **“应用修正”** 按钮，脚本就会在后台根据您的最终决定批量移动视频。


### 场景二：使用沉浸式侧边按钮

1.  **访问页面**: 任意打开一个B站的视频播放页 (例如 `https://www.bilibili.com/video/BV...`)。
2.  **侧边按钮**: 在页面右侧会看到一个优雅的AI分类按钮，采用毛玻璃效果设计。
3.  **触发分析**: 点击按钮后，按钮会显示加载动画，脚本开始分析当前视频内容。
4.  **展开推荐面板**: 分析完成后，按钮会显示成功状态，并自动展开推荐面板。
5.  **一键收藏**:
-   如果接受AI推荐，直接点击 **"接受推荐"** 按钮，视频会自动收藏到推荐的收藏夹。
-   如果拒绝推荐，点击 **"拒绝推荐"** 按钮，可以手动选择其他收藏夹。
-   点击 **"×"** 按钮可以关闭推荐面板。
6.  **按钮状态反馈**: 按钮会根据不同状态显示不同的视觉效果：
-   **空闲状态**: 淡粉色背景，带有微妙的脉冲动画
-   **加载状态**: 旋转的加载动画，表示正在分析
-   **成功状态**: 明亮的绿色，表示分析完成
-   **错误状态**: 红色警告，表示分析失败

    
    ## 🛠️ 开发指南
    
    本项目已采用现代化前端工作流，使用 Vite 和 Vue.js 进行开发和构建。

### 1. 环境准备

-   [Node.js](https://nodejs.org/) (建议使用 LTS 版本)
-   [pnpm](https://pnpm.io/installation) (可选，推荐使用)

### 2. 安装依赖

克隆项目到本地，然后在项目根目录下运行：

```bash
npm install
# 或者使用 pnpm
# pnpm install
```

### 3. 开发模式

运行以下命令启动 Vite 开发服务器：

```bash
npm run dev
```

Vite 会在 `dist` 目录下生成一个开发版本的油猴脚本 (`bilibili-favorites-classifier-userscript.dev.user.js`)。您只需在 Tampermonkey 中安装一次此脚本，之后 Vite 的热更新 (HMR) 会在您修改代码时自动刷新页面，无需手动重装脚本。

### 4. 构建脚本

当您完成开发后，运行以下命令来打包最终的生产版本脚本：

```bash
npm run build
```

构建好的单文件脚本会输出到 `dist/bilibili-favorites-classifier-userscript.user.js`，这个文件就是可以发布和分享给他人安装的版本。

### 5. 运行测试

本项目使用 Jest 进行单元测试。运行以下命令来执行所有测试用例：

```bash
npm test
```

---

## ⚙️ 项目结构

项目采用现代化的前端架构，实现了清晰的关注点分离。核心目录结构如下：

-   **`src/`**: 存放所有源代码，包括 Vue 组件、Pinia 状态管理、业务服务和工具函数。
-   **`dist/`**: 存放由 Vite 构建生成的最终用户脚本文件。
-   **`vite.config.js`**: Vite 的配置文件。
-   **`package.json`**: 项目依赖和脚本命令。

为了帮助开发者快速理解代码，我们提供了一份详细的 **功能映射表**，该文档清晰地列出了每个功能模块、组件与其对应的源代码文件。

**[➡️ 查看详细的功能映射表 (功能映射表.md)](功能映射表.md)**

---

## 📝 更新日志

### 最新版本: v3.2.0 - 性能与安全优化
- **数据获取优化**: 提升了数据加载性能，避免重复请求。
- **CSRF Token 安全增强**: 统一并强化了 CSRF Token 的处理机制。
- **数据完整性验证**: 增加了数据校验，提高了系统稳定性。
- **代码模块化改进**: 进一步优化了代码结构，提升了可维护性。
- **测试框架完善**: 增加了单元测试和集成测试，确保代码质量。

**[➡️ 查看完整的更新历史 (CHANGELOG.md)](CHANGELOG.md)**